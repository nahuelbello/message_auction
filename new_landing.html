<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0L3MMEZ5C5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0L3MMEZ5C5');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Message Auction is an innovative dApp where your messages transform into bids, blending fun, transparency, and blockchain rewards.">
  <link rel="icon" type="image/png" sizes="32x32" href="message_auction_logo.PNG">
  <title>Message Auction</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ---------------------- Global Styles ---------------------- */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #121212, #1e1e1e);
      margin: 0;
      padding: 0;
      color: #e0e0e0;
      scroll-behavior: smooth;
    }
    /* Header & Sticky Banner */
    header {
      position: sticky;
      top: 0;
      z-index: 1100;
      background: linear-gradient(135deg, #00C853, #B2FF59);
      padding: 20px;
      transition: padding 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    header.shrink {
      padding: 10px;
    }
    #bannerMessage {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      color: #ffffff;
      text-shadow: 0 0 10px #00ff00;
      text-align: center;
    }
    /* ---------------------- Sección 2: Hero Text ---------------------- */
    #hero-text {
      text-align: center;
      padding: 40px 20px;
    }
    #hero-text h1 {
      font-size: 3rem;
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 10px;
      color: #00E676;
    }
    #hero-text p {
      font-size: 1.2rem;
    }
    /* ---------------------- Sección 3: Qué es Message Auction ---------------------- */
    #what-is {
      text-align: center;
      padding: 40px 20px;
    }
    #what-is h2 {
      font-family: 'Orbitron', sans-serif;
      color: #B2FF59;
      margin-bottom: 20px;
    }
    #what-is p {
      margin-bottom: 15px;
    }
    #what-is ul {
      list-style: none;
      padding: 0;
      margin: 0 auto 20px;
      max-width: 400px;
      text-align: left;
    }
    #what-is ul li {
      margin: 10px 0;
    }
    /* ---------------------- Sección 4: Cómo Gano Dinero ---------------------- */
    #how-to-earn {
      text-align: center;
      padding: 40px 20px;
    }
    #how-to-earn h2 {
      font-family: 'Orbitron', sans-serif;
      color: #B2FF59;
      margin-bottom: 20px;
    }
    #how-to-earn p {
      margin-bottom: 15px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    /* ---------------------- Sección 5: Instrucciones de Participación ---------------------- */
    #instructions {
      padding: 40px 20px;
    }
    #instructions h2 {
      text-align: center;
      font-family: 'Orbitron', sans-serif;
      color: #B2FF59;
      margin-bottom: 20px;
    }
    .instruction {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    /* Alternar orden de texto y screenshot */
    .instruction.left .instruction-text {
      order: 1;
      width: 45%;
      padding: 10px;
      text-align: left;
    }
    .instruction.left .instruction-screenshot {
      order: 2;
      width: 45%;
      padding: 10px;
      text-align: center;
    }
    .instruction.right .instruction-text {
      order: 2;
      width: 45%;
      padding: 10px;
      text-align: right;
    }
    .instruction.right .instruction-screenshot {
      order: 1;
      width: 45%;
      padding: 10px;
      text-align: center;
    }
    .screenshot {
      background: #FF9800;
      color: #121212;
      padding: 20px;
      border-radius: 8px;
      font-weight: bold;
    }
    /* ---------------------- Sección 6: Simula tu Participación ---------------------- */
    #simulation {
      text-align: center;
      padding: 40px 20px;
    }
    #simulation h2 {
      font-family: 'Orbitron', sans-serif;
      color: #B2FF59;
      margin-bottom: 20px;
    }
    #simulation p {
      margin-bottom: 15px;
    }
    .simulate-input-group {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .simulate-input-group input,
    .simulate-input-group button {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #00C853;
      border-radius: 6px;
      background: #2c2c2c;
      color: #e0e0e0;
      width: 200px;
    }
    /* ---------------------- Sección 7: Latest Bids ---------------------- */
    #latest-bids {
      text-align: center;
      padding: 40px 20px;
    }
    #latest-bids h2 {
      font-family: 'Orbitron', sans-serif;
      color: #B2FF59;
      margin-bottom: 20px;
    }
    #bidHistory p {
      font-size: 0.9rem;
      margin: 5px 0;
    }
    /* ---------------------- Sección 8: Transparencia ---------------------- */
    #transparency-info {
      text-align: center;
      padding: 40px 20px;
      font-size: 0.9rem;
      max-width: 800px;
      margin: 0 auto;
    }
    #transparency-info a {
      color: #00E676;
      text-decoration: underline;
      font-weight: bold;
    }
    /* ---------------------- Sección 9: CTA (Call to Action) ---------------------- */
    #cta {
      text-align: center;
      padding: 40px 20px;
    }
    #cta button {
      background: #00C853;
      border: none;
      color: #fff;
      padding: 20px 30px;
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #cta button:hover {
      background: #00E676;
    }
    /* ---------------------- Sección 10: Footer ---------------------- */
    footer {
      width: 100%;
      background: #1e1e1e;
      color: #e0e0e0;
      text-align: center;
      padding: 10px 20px;
      margin-top: 20px;
    }
    .footer-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .footer-links {
      margin-bottom: 5px;
    }
    .footer-links a {
      color: #00E676;
      text-decoration: none;
      margin: 0 10px;
    }
    .footer-links a:hover {
      text-decoration: underline;
    }
    /* ---------------------- Estilos Existentes (Widget, Modal, etc.) ---------------------- */
    .widget {
      background: linear-gradient(145deg, #1e1e1e, #2c2c2c);
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5), 0 0 15px rgba(0,200,83,0.3);
      width: 90%;
      max-width: 600px;
      margin: 40px auto;
      animation: fadeIn 1s ease-in, glowBorder 2s infinite alternate;
      position: relative;
      text-align: center;
    }
    .input-group {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .input-group input {
      flex: 1;
    }
    .small-preview {
      margin-left: 8px;
      padding: 12px;
      border: 1px solid #00C853;
      border-radius: 6px;
      background: #2c2c2c;
      color: #00E676;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
      white-space: nowrap;
      max-width: 130px;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .small-preview:hover {
      background: #00E676;
      color: #121212;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      font-size: 16px;
      border: 1px solid #00C853;
      border-radius: 6px;
      box-sizing: border-box;
      background: #2c2c2c;
      color: #e0e0e0;
    }
    input:focus {
      outline: none;
      border-color: #00E676;
      box-shadow: 0 0 8px #00E676;
    }
    button {
      background: #00C853;
      border: none;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #00E676;
    }
    hr {
      border: none;
      border-top: 1px solid #333;
      margin: 20px 0;
    }
    @keyframes glowBorder {
      0% { border: 1px solid rgba(0,200,83,0.2); }
      100% { border: 1px solid rgba(0,200,83,0.5); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
      position: relative;
      background: #1e1e1e;
      margin: 10% auto;
      padding: 20px;
      border-radius: 12px;
      width: 80%;
      max-width: 500px;
      text-align: center;
      color: #e0e0e0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      animation: fadeIn 0.5s ease-in;
    }
    .close-modal {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      font-size: 16px;
      color: #fff;
    }
    .preview-banner {
      background: linear-gradient(135deg, #00C853, #B2FF59);
      padding: 40px 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      color: #fff;
      text-shadow: 0 0 8px #00ff00;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    /* Floating Buttons */
    .floating-buttons {
      position: fixed;
      left: 15px;
      top: 70%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 0px;
      z-index: 1000;
    }
    .floating-btn {
      background: linear-gradient(135deg, #00C853, #00E676);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,200,83,0.6), 0 0 10px rgba(0,200,83,0.3);
      transition: all 0.3s ease;
    }
    .floating-btn:hover {
      background: linear-gradient(135deg, #00E676, #B2FF59);
      transform: scale(1.05);
      box-shadow: 0 6px 18px rgba(0,200,83,0.8), 0 0 30px rgba(0,200,83,0.5);
    }
    .fixed-logo {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 80px;
      height: auto;
      z-index: 1000;
      opacity: 0.9;
    }
    @media (max-width: 768px) {
      .banner { font-size: 2.5rem; padding: 30px 10px; }
      .fixed-logo { bottom: 100px; right: 20px; width: 70px; }
      .widget { width: 95%; padding: 20px; }
      h1, h2 { font-size: 1.5rem; }
      p, .info { font-size: 14px; }
      .input-group { flex-direction: row; align-items: center; gap: 10px; }
      .input-group input { flex: 1; width: auto; padding: 10px; font-size: 14px; }
      .small-preview { width: auto; padding: 9px 12px; margin-left: 0; font-size: 14px; min-width: 80px; max-width: 120px; }
      input, button { padding: 12px; font-size: 16px; }
      .simulate-input-group { flex-direction: row; align-items: center; gap: 10px; }
      .simulate-input-group input { width: 60%; padding: 10px; font-size: 14px; }
      .simulate-input-group button { width: 40%; padding: 10px; font-size: 14px; }
      #chartContainer, #simulationChartContainer { max-width: 200px; margin: 0 auto 15px; }
      canvas { width: 100% !important; height: auto !important; }
      .modal-content, .popup { width: 95%; padding: 15px; font-size: 16px; max-height: 90vh; overflow-y: auto; }
      .modal-content h3 { font-size: 1.5rem; }
      .modal-content p, .modal-content ol { font-size: 14px; line-height: 1.6; }
      .preview-banner { font-size: 1.5rem; padding: 20px 10px; }
      .close-modal, .close-popup { font-size: 20px; }
      .floating-buttons {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        top: auto;
        flex-direction: row;
        gap: 10px;
        width: auto;
      }
      .floating-btn { padding: 10px 15px; font-size: 12px; min-width: 120px; }
      body { padding-bottom: 85px; }
      footer { padding-bottom: 80px; }
    }
  </style>
</head>
<body>
  <!-- Floating Buttons (info modals) -->
  <div class="floating-buttons">
    <button id="aboutBtn" class="floating-btn">About this project</button>
    <button id="instructionsBtn" class="floating-btn">Instructions</button>
    <button id="transparencyBtn" class="floating-btn">Transparency</button>
  </div>

  <!-- Sticky Header con Banner (Sección 1) -->
  <header id="stickyHeader">
    <div class="banner" id="bannerMessage">Loading message...</div>
  </header>

  <!-- Sección 2: Hero Text -->
  <section id="hero-text">
    <h1>Your message, your bids, your rewards</h1>
    <p>Muestra tu mensaje al mundo con la posibilidad de ganar recompensas en ethereum</p>
  </section>

  <!-- Sección 3: ¿Qué es Message Auction? -->
  <section id="what-is">
    <h2>¿Qué es Message Auction?</h2>
    <p>Es una app descentralizada (dApp) en la red de ethereum en la que se combina tu creatividad con la posibilidad de ganar recompensas ilimitadas en ETH.</p>
    <ul>
      <li>Haz público tu mensaje</li>
      <li>Genera dinero a medida que aumenta la puja</li>
      <li>Obtén recompensas en ETH</li>
    </ul>
  </section>

  <!-- Sección 4: ¿Suena bien pero, cómo gano dinero con esto? -->
  <section id="how-to-earn">
    <h2>Suena bien pero, ¿cómo gano dinero con esto?</h2>
    <p>Es simple, cuando haces una nueva puja, ese dinero se reparte entre todas las wallets que hayan participado antes de ti. Esto significa que, a partir de ese momento, tú también te quedarás con un porcentaje de todas las futuras pujas. Cada billetera gana dinero en función de cuántas shares tenga.</p>
  </section>

  <!-- Sección 5: Instrucciones de Participación -->
  <section id="instructions">
    <h2>Te estarás preguntando cómo participar...</h2>
    <!-- Instrucción 1: Texto a la izquierda, screenshot a la derecha -->
    <div class="instruction left">
      <div class="instruction-text">
        <p><strong>Instrucción 1:</strong> Primero que nada, asegúrate de entrar a esta página desde el navegador integrado en tu wallet (MetaMask o Trust, por ej.), ya que de lo contrario, no podrás conectarla.</p>
      </div>
      <div class="instruction-screenshot">
        <div class="screenshot">Screenshot</div>
      </div>
    </div>
    <!-- Instrucción 2: Texto a la derecha, screenshot a la izquierda -->
    <div class="instruction right">
      <div class="instruction-screenshot">
        <div class="screenshot">Screenshot</div>
      </div>
      <div class="instruction-text">
        <p><strong>Instrucción 2:</strong> Una vez hecho esto, conecta tu wallet.</p>
      </div>
    </div>
    <!-- Instrucción 3: Texto a la izquierda, screenshot a la derecha -->
    <div class="instruction left">
      <div class="instruction-text">
        <p><strong>Instrucción 3:</strong> Ahora llegó el momento de pensar en tu mensaje, escribe lo que sea que quieras compartir con el mundo (no hay censura, solo un tope de máximo 50 caracteres). Una vez que lo tengas, introduce la cantidad de ETH que quieres pujar (Recuerda que cada puja debe superar a la anterior por un mínimo de 0.01 ETH).</p>
      </div>
      <div class="instruction-screenshot">
        <div class="screenshot">Screenshot</div>
      </div>
    </div>
    <!-- Instrucción 4: Texto a la derecha, screenshot a la izquierda -->
    <div class="instruction right">
      <div class="instruction-screenshot">
        <div class="screenshot">Screenshot</div>
      </div>
      <div class="instruction-text">
        <p><strong>Instrucción 4:</strong> Una vez realizada tu puja, tu mensaje será el protagonista del banner hasta que alguien más supere tu puja. A medida que vayan participando más usuarios en el futuro, tus recompensas en ETH se irán acumulando aquí.</p>
      </div>
    </div>
    <!-- Instrucción 5: Texto a la izquierda, screenshot a la derecha -->
    <div class="instruction left">
      <div class="instruction-text">
        <p><strong>Instrucción 5:</strong> Para retirar tus ganancias, simplemente conecta nuevamente tu wallet y haz click en withdraw, confirma la transacción y listo, el dinero será retirado a la wallet que usaste para participar. Puedes retirar tu dinero en cualquier momento (siempre y cuando tengas fondos disponibles para retirar obviamente).</p>
      </div>
      <div class="instruction-screenshot">
        <div class="screenshot">Screenshot</div>
      </div>
    </div>
  </section>

  <!-- Sección 6: Simula tu Participación -->
  <section id="simulation">
    <h2>Simula tu participación</h2>
    <p>Aquí puedes simular sin necesidad de conectar tu wallet el porcentaje de shares que obtendrías en tu puja. Mientras más shares acumules, mayor será tu porcentaje de futuras pujas.</p>
    <div id="simulationChartContainer">
      <canvas id="simulationChart"></canvas>
    </div>
    <div class="simulate-input-group">
      <input type="number" id="simulateBidAmount" placeholder="Amount in ETH" step="0.01" min="0">
      <button id="simulateOwnershipBtn">Simulate</button>
    </div>
    <div class="simulation-results">
      <p class="info"><strong>Estimated Ownership:</strong> <span id="estimatedOwnership">0</span>%</p>
      <p class="info"><strong>New Shares:</strong> <span id="newShares">0</span></p>
      <p class="info"><strong>Bonus:</strong> <span id="bonusFactor">1.0</span>x <span id="bonusInfo" class="info-icon">?</span></p>
    </div>
  </section>

  <!-- Sección 7: Últimas Pujas -->
  <section id="latest-bids">
    <h2>Latest bids</h2>
    <div id="bidHistory">
      <!-- Aquí se inyectarán las pujas recientes mediante JavaScript -->
    </div>
  </section>

  <!-- Sección 8: Transparencia -->
  <section id="transparency-info">
    <p>We believe in complete transparency. All our code and the smart contract details can be publicly verified. 
      [<a href="https://github.com/nahuelbello/message_auction.git" target="_blank">Repository</a>] – 
      [<a href="https://etherscan.io/address/0x5B0474f5109D9594A2b818E7c33f8BC68C403dc7#code" target="_blank">Smart Contract</a>]
    </p>
    <p>A 4% founder fee is applied to every bid. This fee is reinvested to improve this project and fund future developments.</p>
    <p>The Early Bird Bonus rewards the first 10 bidders with a higher share multiplier. The first 5 bids receive a 1.5x bonus, while bids 6 to 10 receive a 1.25x bonus – giving you a larger stake in future rewards.</p>
    <p>For any questions or feedback, feel free to reach out via 
      <a href="https://www.linkedin.com/in/nahuel-bello-rendon-9a9710301/" target="_blank">LinkedIn</a> or 
      <a href="https://github.com/nahuelbello" target="_blank">GitHub</a>.
    </p>
  </section>

  <!-- Sección 9: CTA - Botón para ir a la página de puja -->
  <section id="cta">
    <button onclick="location.href='puja.html'">Haz tu puja y comienza a ganar recompensas</button>
  </section>

  <!-- Sección 10: Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-links">
        <a href="https://github.com/nahuelbello/message_auction.git" target="_blank">Repository</a>
        <a href="https://etherscan.io/address/0x5B0474f5109D9594A2b818E7c33f8BC68C403dc7#code" target="_blank">Smart Contract</a>
        <a href="faq.html">FAQ</a>
      </div>
      <p>© 2025 Message Auction. Released under the MIT License.</p>
    </div>
  </footer>

  <!-- Modal para preview del mensaje -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <div class="preview-banner" id="previewBanner">Your Message Preview</div>
      <p>This is how your message will appear in the banner.</p>
    </div>
  </div>

  <!-- Los modales de Shares, Bonus, About, Instructions y Transparency se mantienen tal cual -->
  <div id="sharesPopup" class="popup" style="display: none;">
    <div class="popup-content">
      <span id="closeSharesPopup" class="close-popup">&times;</span>
      <p>Shares represent your contribution to the auction. They are calculated based on your bid amount and a bonus factor, which may apply depending on the order of your bid. Basically, they are your portion of the cake. You can calculate them <a href="#simulateOwnershipSection" id="goToSimulate" style="color: #00E676; text-decoration: underline;">here</a>.</p>
    </div>
  </div>
  <div id="bonusPopup" class="popup" style="display: none;">
    <div class="popup-content">
      <span id="closeBonusPopup" class="close-popup">&times;</span>
      <p>The bonus mechanism rewards early participants by increasing the shares they receive when they bid. For the first 10 bidders, the first 5 get a 1.5x bonus and the next five get a 1.25x bonus. After that, bids receive a standard 1.0x multiplier.</p>
    </div>
  </div>
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span id="closeAbout" class="close-modal">&times;</span>
      <h3>About This Project</h3>
      <p>Message Auction is a playful, community-driven experience where your message takes center stage on our banner until someone outbids you.</p>
      <p>Each time someone places a bid, that amount is proportionally distributed among existing participants according to their shares. The more shares you hold, the larger your portion of each new bid.</p>
      <p>Your message is truly yours – with only a character limit to hold it back, it can be advertising, jokes, or any form of expression you choose.</p>
      <p>It’s a lively blend of friendly competition and real rewards. Jump in and see how far your message (and potential earnings) can go!</p>
    </div>
  </div>
  <div id="instructionsModal" class="modal">
    <div class="modal-content">
      <span id="closeInstructions" class="close-modal">&times;</span>
      <h3>Instructions</h3>
      <ol>
        <li><strong>Connect Your Wallet:</strong> Click “Connect Wallet” to link your browser wallet (e.g., MetaMask). This allows the dApp to read your balance and send transactions.</li>
        <li><strong>Enter Your Message &amp; Bid Amount:</strong> Type a short message (max 50 characters) and specify how much ETH you want to bid.</li>
        <li><strong>Place Your Bid:</strong> Click “Place Bid” and confirm the transaction in your wallet. Your new bid must be at least 0.01 ETH higher than the current bid.</li>
        <li><strong>Watch the Banner:</strong> If your bid is the highest, your message will appear on the banner until someone outbids you.</li>
        <li><strong>Withdraw Your Rewards:</strong> When new bids increase the reward pool, click “Withdraw” to claim your accumulated ETH rewards.</li>
      </ol>
    </div>
  </div>
  <div id="transparencyModal" class="modal">
    <div class="modal-content">
      <span id="closeTransparency" class="close-modal">&times;</span>
      <h3>Transparency</h3>
      <p>We believe in complete transparency. All our code and the smart contract details can be publicly verified. [<a href="https://github.com/nahuelbello/message_auction.git" target="_blank" style="color: #00E676; text-decoration: underline;">Repository</a>] – [<a href="https://etherscan.io/address/0x5B0474f5109D9594A2b818E7c33f8BC68C403dc7#code" target="_blank" style="color: #00E676; text-decoration: underline;">Smart Contract</a>]</p>
      <p>A 4% founder fee is applied to every bid. This fee is reinvested to improve this project and fund future developments.</p>
      <p>The Early Bird Bonus rewards the first 10 bidders with a higher share multiplier (1.5x for the first 5, 1.25x for the next 5).</p>
      <p>For any questions or feedback, feel free to reach out via <a href="https://www.linkedin.com/in/nahuel-bello-rendon-9a9710301/" target="_blank">LinkedIn</a> or <a href="https://github.com/nahuelbello" target="_blank">GitHub</a>.</p>
    </div>
  </div>

  <!-- Scripts: Ethers, WalletConnect, Web3Modal, and Custom JS -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <script>
    // ---------------------- Helper Functions ----------------------
    function getCustomErrorMessage(err, context) {
      const message = err.message || "";
      if (context === "placeBid") {
        if (message.includes("New bid must exceed current bid"))
          return "Your bid must exceed the current bid by at least 0.01 ETH.";
        else if (message.includes("Initial bid must be"))
          return "Your initial bid must be at least 0.01 ETH.";
        else if (message.includes("Founder fee transfer failed"))
          return "Failed to transfer founder fee. Please try again.";
      } else if (context === "withdraw") {
        if (message.includes("No shares"))
          return "You have no shares.";
        else if (message.includes("No funds to withdraw"))
          return "There are no funds available for withdrawal.";
        else if (message.includes("Withdrawal failed"))
          return "Withdrawal failed. Please try again.";
      } else if (context === "simulate") {
        if (message.includes("invalid value"))
          return "Please enter a valid ETH amount.";
      } else if (context === "connectWallet") {
        return "Failed to connect wallet. Please try again.";
      }
      return "";
    }
    
    function formatSharesFriendly(bigNum) {
      const divisor = ethers.BigNumber.from("1000000000000"); // 1e12
      const friendly = bigNum.div(divisor);
      return friendly.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // ---------------------- Global Variables ----------------------
    const contractAddress = "0x5B0474f5109D9594A2b818E7c33f8BC68C403dc7";
    const contractABI = [
      "function currentBid() view returns (uint256)",
      "function currentMessage() view returns (string)",
      "function currentBidder() view returns (address)",
      "function totalShares() view returns (uint256)",
      "function sharesOf(address) view returns (uint256)",
      "function pendingReward(address user) view returns (uint256)",
      "function placeBid(string memory message) payable",
      "function withdraw()",
      "function totalBids() view returns (uint256)",
      "function earlyBirdClaimed(address) view returns (bool)",
      "function earlyBirdCount() view returns (uint256)",
      "event NewBid(address indexed bidder, uint256 bid, string message)",
      "event Withdrawal(address indexed user, uint256 amount)"
    ];
    let provider, signer, contract, web3Modal;
    let sharesChart, simulationChart;
    const defaultProvider = new ethers.providers.JsonRpcProvider("https://eth-mainnet.g.alchemy.com/v2/T_QL1fNKmAx8mKNHscnvfgYyJ9OkLIxg");
    
    // ---------------------- Status Function ----------------------
    function showStatus(message, isError = false) {
      const statusEl = document.getElementById("status");
      statusEl.innerText = message;
      statusEl.style.backgroundColor = isError ? "#ffcccb" : "#00E676";
      statusEl.style.color = isError ? "#b71c1c" : "#121212";
      statusEl.style.opacity = "1";
      setTimeout(() => { statusEl.style.opacity = "0"; }, 3000);
    }
    
    // ---------------------- Load Bid History ----------------------
    async function loadBidHistory() {
      try {
        const filter = contract.filters.NewBid();
        const events = await contract.queryFilter(filter, 0, "latest");
        const bidHistoryDiv = document.getElementById("bidHistory");
        bidHistoryDiv.innerHTML = "";
        events.reverse().slice(0, 10).forEach(event => {
          const bidder = event.args.bidder;
          const bid = ethers.utils.formatEther(event.args.bid);
          const message = event.args.message;
          const bidElement = document.createElement("p");
          bidElement.innerHTML = `<strong>${bidder}</strong> bid <strong>${bid}</strong> ETH: ${message}`;
          bidHistoryDiv.appendChild(bidElement);
        });
      } catch (err) {
        console.error("Error loading bid history", err);
      }
    }
    
    // ---------------------- Main Functions ----------------------
    async function init() {
      try {
        console.log("Initializing application...");
        if (window.ethereum) {
          provider = new ethers.providers.Web3Provider(window.ethereum);
          console.log("Using Web3Provider with window.ethereum");
        } else {
          provider = new ethers.providers.JsonRpcProvider("https://eth-mainnet.g.alchemy.com/v2/T_QL1fNKmAx8mKNHscnvfgYyJ9OkLIxg");
          console.log("Using JsonRpcProvider fallback");
        }
        try {
          const network = await provider.getNetwork();
          console.log("Connected network:", network);
        } catch (e) {
          console.error("Error connecting to the network:", e);
          showStatus("Network connection error", true);
          return;
        }
        contract = new ethers.Contract(contractAddress, contractABI, provider);
        console.log("Contract initialized");
        await getCurrentState();
        updateSimulationChart(0);
        contract.on("NewBid", (bidder, bid, message) => {
          console.log("New bid detected");
          getCurrentState();
        });
      } catch (err) {
        console.error("Error in init:", err);
        showStatus("Error initializing application", true);
      }
    }
    
    async function connectWallet() {
      try {
        console.log("Connecting wallet...");
        const providerOptions = {
          walletconnect: {
            package: window.WalletConnectProvider,
            options: {
              rpc: {
                1337: "https://eth-mainnet.g.alchemy.com/v2/T_QL1fNKmAx8mKNHscnvfgYyJ9OkLIxg",
                31337: "https://eth-mainnet.g.alchemy.com/v2/T_QL1fNKmAx8mKNHscnvfgYyJ9OkLIxg"
              }
            }
          }
        };
        if (!web3Modal) {
          web3Modal = new window.Web3Modal.default({
            cacheProvider: false,
            providerOptions,
            disableInjectedProvider: false,
          });
        }
        const externalProvider = await web3Modal.connect();
        provider = new ethers.providers.Web3Provider(externalProvider);
        if (!await checkNetwork()) return;
        signer = provider.getSigner();
        const address = await signer.getAddress();
        console.log("Wallet connected:", address);
        contract = new ethers.Contract(contractAddress, contractABI, signer);
        document.getElementById("connectWalletBtn").style.display = "none";
        document.getElementById("disconnectWalletBtn").style.display = "block";
        showStatus("Wallet connected successfully!");
        await getCurrentState();
      } catch (e) {
        console.error("Error connecting wallet:", e);
        let customMessage = getCustomErrorMessage(e, "connectWallet");
        if (!customMessage) customMessage = "Error connecting wallet.";
        showStatus(customMessage, true);
      }
    }
    
    function disconnectWallet() {
      if (web3Modal) { web3Modal.clearCachedProvider(); }
      provider = defaultProvider;
      signer = null;
      contract = new ethers.Contract(contractAddress, contractABI, provider);
      document.getElementById("connectWalletBtn").style.display = "block";
      document.getElementById("disconnectWalletBtn").style.display = "none";
      showStatus("Wallet disconnected.");
    }
    
    async function getCurrentState() {
      try {
        console.log("Getting current state...");
        if (!contract) {
          console.error("Contract not initialized");
          showStatus("Error: Contract not initialized", true);
          return;
        }
        let message, bid, totalShares;
        try {
          message = await contract.currentMessage();
          console.log("Current message:", message);
        } catch (e) {
          console.error("Error loading message:", e);
          message = "Error loading message";
        }
        try {
          bid = await contract.currentBid();
          console.log("Current bid:", ethers.utils.formatEther(bid));
        } catch (e) {
          console.error("Error loading bid:", e);
          bid = ethers.BigNumber.from("0");
        }
        try {
          totalShares = await contract.totalShares();
          console.log("Total shares:", totalShares.toString());
        } catch (e) {
          console.error("Error loading total shares:", e);
          totalShares = ethers.BigNumber.from("0");
        }
        if (message.trim() === "") { message = "This is your message"; }
        document.getElementById("bannerMessage").innerText = message;
        document.getElementById("currentBid").innerText = ethers.utils.formatEther(bid);
        document.getElementById("totalShares").innerText = formatSharesFriendly(totalShares);
        
        updateChart(0);

        if (signer) {
          try {
            const userAddress = await signer.getAddress();
            console.log("User address:", userAddress);
            const userShares = await contract.sharesOf(userAddress);
            console.log("User shares:", userShares.toString());
            const pending = await contract.pendingReward(userAddress);
            console.log("Pending reward:", ethers.utils.formatEther(pending));
            let userSharesPercentage = "0";
            if (!totalShares.eq(0)) {
              const percentage = userShares.mul(10000).div(totalShares).toNumber() / 100;
              userSharesPercentage = percentage.toFixed(2);
            }
            document.getElementById("pendingReward").innerText = ethers.utils.formatEther(pending);
            document.getElementById("userSharesPercentage").innerText = userSharesPercentage;
            updateChart(parseFloat(userSharesPercentage));
          } catch (e) {
            console.error("Error getting user data:", e);
            showStatus("Error loading user data", true);
          }
        }
        await loadBidHistory();
      } catch (err) {
        console.error("General error in getCurrentState:", err);
        showStatus("Error loading contract state", true);
      }
    }
    
    function updateChart(userPercentage) {
      const ctx = document.getElementById('sharesChart').getContext('2d');
      if (!sharesChart) {
        sharesChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Your Shares', 'Other Shares'],
            datasets: [{
              data: [userPercentage, 100 - userPercentage],
              backgroundColor: ['#00E676', '#424242']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { animateRotate: true },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label;
                    let value = context.parsed;
                    return label + ': ' + value + '%';
                  }
                }
              }
            }
          }
        });
      } else {
        sharesChart.data.datasets[0].data = [userPercentage, 100 - userPercentage];
        sharesChart.update();
      }
    }
    
    function updateSimulationChart(simPercentage) {
      const ctxSim = document.getElementById('simulationChart').getContext('2d');
      if (!simulationChart) {
        simulationChart = new Chart(ctxSim, {
          type: 'doughnut',
          data: {
            labels: ['Your Simulated Shares', 'Other Shares'],
            datasets: [{
              data: [simPercentage, 100 - simPercentage],
              backgroundColor: ['#00E676', '#424242']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { animateRotate: true },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label;
                    let value = context.parsed;
                    return label + ': ' + value + '%';
                  }
                }
              }
            }
          }
        });
      } else {
        simulationChart.data.datasets[0].data = [simPercentage, 100 - simPercentage];
        simulationChart.update();
      }
    }
    
    document.getElementById("newMessage").addEventListener("input", () => {
      const text = document.getElementById("newMessage").value || "This is your message";
      document.getElementById("smallPreview").innerText = text;
    });
    
    document.getElementById("smallPreview").addEventListener("click", () => {
      let text = document.getElementById("newMessage").value;
      if (text.trim() === "") { text = "This is your message"; }
      document.getElementById("previewBanner").innerText = text;
      document.getElementById("modal").style.display = "block";
    });
    
    document.getElementById("placeBidBtn").addEventListener("click", async () => {
      if (!signer) { 
        alert("Please connect your wallet.");
        return;
      }
      const newMessage = document.getElementById("newMessage").value;
      const bidAmount = document.getElementById("bidAmount").value;
      if (!newMessage || !bidAmount) {
        alert("Please enter a message and an amount.");
        return;
      }
      try {
        showStatus("Sending transaction...");
        const tx = await contract.placeBid(newMessage, {
          value: ethers.utils.parseEther(bidAmount)
        });
        await tx.wait();
        showStatus("Bid placed successfully!");
        document.getElementById("newMessage").value = "";
        document.getElementById("bidAmount").value = "";
        await getCurrentState();
      } catch (err) {
        console.error(err);
        let customMessage = getCustomErrorMessage(err, "placeBid");
        if (!customMessage) customMessage = "Error placing bid.";
        showStatus(customMessage, true);
      }
    });
    
    document.getElementById("withdrawBtn").addEventListener("click", async () => {
      if (!signer) { 
        alert("Please connect your wallet.");
        return;
      }
      try {
        showStatus("Processing withdrawal...");
        const tx = await contract.withdraw();
        await tx.wait();
        showStatus("Funds withdrawn successfully!");
        await getCurrentState();
      } catch (err) {
        console.error(err);
        let customMessage = getCustomErrorMessage(err, "withdraw");
        if (!customMessage) customMessage = "Error withdrawing funds.";
        showStatus(customMessage, true);
      }
    });
    
    document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
    document.getElementById("disconnectWalletBtn").addEventListener("click", disconnectWallet);
    
    // Close preview modal
    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
    });
    window.addEventListener("click", (event) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
    
    // Toggle logic for shares explanation popup
    const sharesInfoIcon = document.getElementById("sharesInfo");
    const sharesPopup = document.getElementById("sharesPopup");
    const closeSharesPopup = document.getElementById("closeSharesPopup");
    function toggleSharesPopup() {
      sharesPopup.style.display = (sharesPopup.style.display === "block") ? "none" : "block";
    }
    if (sharesInfoIcon) {
      sharesInfoIcon.addEventListener("click", toggleSharesPopup);
    }
    closeSharesPopup.addEventListener("click", () => {
      sharesPopup.style.display = "none";
    });
    window.addEventListener("click", (event) => {
      if (!sharesPopup.contains(event.target) && event.target !== sharesInfoIcon) {
        sharesPopup.style.display = "none";
      }
    });
    
    // Bonus info popup logic
    const bonusInfoIcon = document.getElementById("bonusInfo");
    const bonusPopup = document.getElementById("bonusPopup");
    const closeBonusPopup = document.getElementById("closeBonusPopup");
    const goToSimulate = document.getElementById("goToSimulate");
    function toggleBonusPopup() {
      bonusPopup.style.display = (bonusPopup.style.display === "block") ? "none" : "block";
    }
    if (bonusInfoIcon) {
      bonusInfoIcon.addEventListener("click", toggleBonusPopup);
    }
    closeBonusPopup.addEventListener("click", () => {
      bonusPopup.style.display = "none";
    });
    window.addEventListener("click", (event) => {
      if (!bonusPopup.contains(event.target) && event.target !== bonusInfoIcon) {
        bonusPopup.style.display = "none";
      }
    });
    if (goToSimulate) {
      goToSimulate.addEventListener("click", () => {
        sharesPopup.style.display = "none";
      });
    }
    
    // Floating buttons: About, Instructions and Transparency
    const aboutBtn = document.getElementById("aboutBtn");
    const instructionsBtn = document.getElementById("instructionsBtn");
    const transparencyBtn = document.getElementById("transparencyBtn");
    const aboutModal = document.getElementById("aboutModal");
    const instructionsModal = document.getElementById("instructionsModal");
    const transparencyModal = document.getElementById("transparencyModal");
    const closeAbout = document.getElementById("closeAbout");
    const closeInstructions = document.getElementById("closeInstructions");
    const closeTransparency = document.getElementById("closeTransparency");
    function closeAllModals() {
      document.querySelectorAll('.modal').forEach(modal => modal.style.display = "none");
    }
    aboutBtn.addEventListener("click", () => {
      closeAllModals();
      aboutModal.style.display = "block";
    });
    instructionsBtn.addEventListener("click", () => {
      closeAllModals();
      instructionsModal.style.display = "block";
    });
    transparencyBtn.addEventListener("click", () => {
      closeAllModals();
      transparencyModal.style.display = "block";
    });
    closeAbout.addEventListener("click", () => { aboutModal.style.display = "none"; });
    closeInstructions.addEventListener("click", () => { instructionsModal.style.display = "none"; });
    closeTransparency.addEventListener("click", () => { transparencyModal.style.display = "none"; });
    window.addEventListener("click", (event) => {
      if (event.target === aboutModal) { aboutModal.style.display = "none"; }
      if (event.target === instructionsModal) { instructionsModal.style.display = "none"; }
      if (event.target === transparencyModal) { transparencyModal.style.display = "none"; }
    });
    
    document.getElementById("simulateOwnershipBtn").addEventListener("click", async () => {
      const bidAmount = document.getElementById("simulateBidAmount").value;
      if (!bidAmount || parseFloat(bidAmount) <= 0) {
        showStatus("Please enter a valid amount in ETH.", true);
        return;
      }
      try {
        console.log("Simulate clicked with amount:", bidAmount);
        const bidValue = ethers.utils.parseEther(bidAmount);
        const SCALE = ethers.BigNumber.from("1000000000000");
        let bonusFactor = SCALE;
        let currentUserShares = ethers.BigNumber.from("0");
        let currentTotalShares = await contract.totalShares();
        if (signer) {
          const userAddress = await signer.getAddress();
          currentUserShares = await contract.sharesOf(userAddress);
          const hasClaimedBonus = await contract.earlyBirdClaimed(userAddress);
          const earlyBirdCount = await contract.earlyBirdCount();
          if (!hasClaimedBonus && earlyBirdCount.lt(10)) {
            bonusFactor = earlyBirdCount.lt(5)
              ? ethers.BigNumber.from("1500000000000")
              : ethers.BigNumber.from("1250000000000");
          }
        }
        const newShares = bidValue.mul(bonusFactor).div(SCALE);
        const finalUserShares = currentUserShares.add(newShares);
        const newTotalShares = currentTotalShares.add(newShares);
        let ownershipPercentage = 0;
        if (!newTotalShares.isZero()) {
          ownershipPercentage = finalUserShares.mul(10000).div(newTotalShares).toNumber() / 100;
        }
        document.getElementById("estimatedOwnership").innerText = ownershipPercentage.toFixed(2);
        document.getElementById("newShares").innerText = formatSharesFriendly(newShares);
        document.getElementById("bonusFactor").innerText = (bonusFactor.toNumber() / SCALE.toNumber()).toFixed(2);
        updateSimulationChart(ownershipPercentage);
        showStatus("Simulation completed successfully!");
      } catch (err) {
        console.error("Error in simulation:", err);
        let customMessage = getCustomErrorMessage(err, "simulate");
        if (!customMessage) customMessage = "Error performing simulation.";
        showStatus(customMessage, true);
      }
    });
    
    async function checkNetwork() {
      try {
        const network = await provider.getNetwork();
        console.log("Current network:", network);
        if (network.chainId !== 1) {
          showStatus("Please connect to the correct network", true);
          return false;
        }
        return true;
      } catch (e) {
        console.error("Error checking network:", e);
        return false;
      }
    }
    
    // ---------------------- Sticky Header Shrink Effect ----------------------
    window.addEventListener("scroll", () => {
      const header = document.getElementById("stickyHeader");
      if (window.scrollY > 50) {
        header.classList.add("shrink");
      } else {
        header.classList.remove("shrink");
      }
    });
    
    // Initialize on window load
    window.onload = init;
  </script>
  <img src="./message_auction_logo.PNG" alt="Logo" class="fixed-logo">
</body>
</html>
